## configuration settings
BIN_DIR       := @bindir@
LIB_DIR       := @libdir@@versiondir@
DOCDIR        := @docdir@@versiondir@
MANDIR        := @mandir@@versiondir@

# Set up extensions
LOAD_EXT      := @load_ext@
O             := @o@

# Various paths
PMC_DIR       := src/pmc
DECNUMBER_DIR := src/decNumber

## Setup some commands
MAKE          := @make_c@
PERL          := @perl@
CAT           := @cat@
CHMOD         := @chmod@
CP            := @cp@
MKPATH        := @mkpath@
RM_F          := @rm_f@
RM_RF         := @rm_rf@
#IF(parrot_is_shared and not(cygwin or win32)):export LD_RUN_PATH := @blib_dir@:$(LD_RUN_PATH)
#IF(darwin):
#IF(darwin):# MACOSX_DEPLOYMENT_TARGET must be defined for OS X compilation/linking
#IF(darwin):export MACOSX_DEPLOYMENT_TARGET := @osx_version@
#IF(@bigendian@):ENDIAN        := -DDECLITEND=0
#ELSE:ENDIAN        := -DDECLITEND=1
CC            := @cc@ -c
CC_OUT        := @cc_o_out@
CFLAGS        := @ccflags@ @cc_shared@ @cc_debug@ @ccwarn@ @cc_hasjit@\
                 @cg_flag@ @gc_flag@ $(ENDIAN) -DDECUSE64=0 -DDECDPUN=4\
                 -DDECNUMDIGITS=512 -DDECSUBSET=0

PMC_DEPS := \
    $(PMC_DIR)/decbase.pmc \
    $(PMC_DIR)/decnumcontext.pmc \
    $(PMC_DIR)/decnum.pmc

DOCS := README

BUILD_CLEANUPS := build/*

TEST_CLEANUPS :=

# the default target
all: decnumber pmc

pmc: $(PMC_DEPS)
	$(MAKE) $(PMC_DIR)

decnumber: build/decContext$(O) build/decNumber$(O)

build/decContext$(O): $(DECNUMBER_DIR)/decContext.c \
                      $(DECNUMBER_DIR)/decContext.h
	$(CC) $(CFLAGS) $(CC_OUT)build/decContext$(O) $(DECNUMBER_DIR)/decContext.c

build/decNumber$(O): $(DECNUMBER_DIR)/decNumber.c \
                     $(DECNUMBER_DIR)/decNumber.h \
                     $(DECNUMBER_DIR)/decContext.h
	$(CC) $(CFLAGS) $(CC_OUT)build/decNumber$(O) $(DECNUMBER_DIR)/decNumber.c

# This is a listing of all targets, that are meant to be called by users
help:
	@echo ""
	@echo "Following targets are available for the user:"
	@echo ""
	@echo "  build:             Build the dynpmcs."
	@echo "                     This is the default."
	@echo "  install:           Install the installable targets and docs."
	@echo ""
	@echo "Testing:"
	@echo "  test:              Run the test suite."
	@echo "  testclean:         Clean up test results."
	@echo ""
	@echo "Cleaning:"
	@echo "  clean:             Basic cleaning up."
	@echo "  realclean:         Removes also files generated by 'Configure.pl'"
	@echo ""
	@echo "Misc:"
	@echo "  help:              Print this help message."
	@echo ""

test: all
	$(PERL) t/harness

install: build-pmc
	$(MAKE) $(PMC_DIR) install

uninstall:
	$(MAKE) $(PMC_DIR) uninstall

testclean:
	$(RM_F) $(TEST_CLEANUPS)

pmc_clean:
	$(MAKE) $(PMC_DIR) clean 

clean: pmc_clean
	$(RM_F) $(TEST_CLEANUPS) $(BUILD_CLEANUPS)

pmc_realclean:
	$(MAKE) $(PMC_DIR) realclean

realclean: pmc_realclean
	$(RM_F) $(TEST_CLEANUPS) $(BUILD_CLEANUPS) Makefile

# Local variables:
#   mode: makefile
# End:
# vim: ft=make:
